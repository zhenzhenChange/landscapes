# Architecture Road: Framework Design

## 骚话

框架设计这类问题貌似就属于那种「火候未到，无需了解；时机到了，自然就懂」系列。

一来，网络上有关于这类话题的资料相对较少，而且其中大部分还只是概括，虽有抽象却又戛然而止。

再者，有能力设计框架的人，先不管占比如何，最终呈现出来的只会是「框架成品 + 使用文档」。设计理念或许会被提及，但详细的设计历程可能需要自行去挖掘。

当然，一直以来互联网技术发展的重要信息都会采用 RFC 进行讨论记录，这在一定程度上保留了某项提议的整个设计历程。所以目前很多框架、语言乃至标准，都会采用这种形式去确定未来的设计发展。要想了解一个框架或语言标准的“近代史”，除非有个活化石站在你面前，不然最有说服力的资料就非 RFC 莫属了（等等，这是人能读的玩意？）。

在去年（2022）年底的时候我有过这样的疑问：框架设计的核心要素是哪些？

当时搜寻过一些资料，但关于这方面的内容，如前文所说，有实际意义的实在是不多。最终也只是与他人交流了一下这类问题，顺便读一读《JavaScript 框架设计》一书。

那么现在，结合一些不成熟的构（huàn）思（xiǎng），先给自己挖个大坑。

声明：框架设计应当包含两层蕴意，即「设计 + 实现」，本文将着重于有关设计方面的思考，也可以理解为这是虚拟创作。

所以在此之前，我们先做个假设：假设你拥有了实现一切的能力，掌握了必备的领域知识，那么剩下的请结合你对业务、计算机、软件工程的理解，充分发挥你的想象力去做设计。

## 框架的定义

先思考几个问题：什么是框（kuàng）架（jià）？其作用又是什么？

基于[百度百科](https://baike.baidu.com/item/%E6%A1%86%E6%9E%B6/1212667)词条，框架这个概念最早应该是出于建筑学，于软件工程中最为流行。

比如本文的大体结构已经构思（规划）完毕，这个结构也可称之为框架。

概念性的总结一下框架的定义：**用于「支撑（架）」复杂抽象的，具有「约束性（框）」的，基本通用结构。**

站在软件工程的角度上来说，框架是个半成品，当基于它补充完「特定的抽象实现（业务）」之后，即可形成一个完整的软件应用。

所以，框架不仅仅是一个提效工具，因其又具有一定的约束性，应该在提高效率的基础上保证产品（代码）质量，即还需要蕴涵一个最佳实践。

## 软件与建筑

从框架的定义中可以看出，软件架构与建筑架构颇有渊源，那么它们之间又有何不同呢？

显而易见，软件是虚拟的，建筑是真实的。

<!-- 因此，软件在生命周期迭代过程中，可以改变现有的设计，可以是改善、删除或新增。而建筑不能，建筑一旦建好，你想换个地基是非常困难的，不亚于重建。所以，建筑的架构设计必须是完完全全、方方面面都需要考虑到的。 -->

如果一款软件的架构设计需要考虑方方面面，那这是不是过度设计了呢？

**一个良好的设计应当面向当下，又兼顾未来。反之，过度设计就是盲目的追逐未来而忽略了当下，最终可能会促使软件危机的发生。**

未来都是充满不确定性的，因此需要不断的对当下的架构进行迭代优化，而兼顾指的是留下后门而不是堵死后路，所谓软件工程没有银弹。

所以，过度设计其实更多的是指实现，亦或是业务需求的不切实际，尊崇所谓的教条主义。

> _路人甲: 理想很丰满，现实很骨感。_
>
> _路人乙: 过度设计就是鸭子还没打下来，就在争论怎么吃的问题。_
>
> _Robert C. Martin: 一开始就做对系统，纯属神话。_
>
> _Edsger Wybe Dijkstra: 在没有机器的时候，编程根本不是问题；当我们有了电脑，编程开始变成问题。_

## 框架设计的核心要素一：框架定位

主要思考两个方面：迎合用户还是固执己见？所要覆盖的领域范围

业务框架，上层框架，底层框架

## 框架设计的核心要素二：量身定制的 DSL

## 框架设计的核心要素三：伴生工具链及其生态

## 框架的设计能力

## 框架的实现能力

## 框架的必备能力：依赖注入

编译

第一要素：要覆盖的领域范围；
即框架定位。
跨平台？跨语言？
传统业务？游戏开发？
第二要素：量身定制一套 DSL；
VDom？IDom？NonVDom？
函数式？面向对象？
响应式？不变性？
命令式？声明式？
分层架构还是分文件夹架构？领域聚合？都主导高内聚、低耦合，你“分文件夹架构”是一点边都不沾呐
Template？JSX？Web Components？
原汁原味（React）？魔法极端（Svelte）？
迎合用户？固执己见？
这世上本没有路，走的人多了，便成了路。迪士尼乐园的路径设计
为什么公园花园里总是有人踩出来的近路，为什么在设计的时候不能直接铺近路？ - blakan 的回答 - 知乎 <https://www.zhihu.com/question/22432097/answer/21334005>
我认为固执己见会比较合适，当然，这里的固执己见应该是，有框架设计能力的人的观点。并不是说普通开发者就没有发言权，问题在于，需要站在全局的角度去发表观点。
框架理解能力 != 框架设计能力 != 框架运用能力
反正 DSL 就是发挥你的想象力，造名词、造概念！最最最重要的是，需要保持一致性，不要多范式共存。
第三要素：伴生工具链及其生态；
参考 Angular 架构
组件库？路由库？表单库？动画库？网络库？国际化？无障碍？交互式文档？图标库？图表库？
打包工具？校验工具？格式化工具？发布工具？测试工具？升级工具？语言服务？
声明式路由与约定式路由，声明式导航与编程式导航？虽然我认为“约定共识”能在一定程度上规范开发流程，但同样的也容易受限，同时还会增加维护成本，最好的做饭就是提供插件化接口，将选择权交由用户选择或实现。modularity or component
当然以上的生态并不是说要全新实现或者做个适配器层，至少需要能做成可插拔式的插件化架构，方便与现有的社区生态集成，隔离外部不稳定性。
同时升级工具应该是必须的，因为框架需要进化，而升级工具则是帮开发者用户降低升级成本。
那么所有以上的东西，80%的实现都与编译有关，So？
什么是编译？将高级抽象降维，转化为低级抽象，直至给到底层计算机执行。
每个人都有心血来潮的时候，设计一个框架，即便不是为了解决目前解决不了或是难以解决的痛点，也是值得研究探索的，哪怕它只是一个玩具。
因为我相信每天花点时间研究，久而久之你就站在了这个领域的前沿。
可能有人会想，一开始就画这么庞大的一个蓝图，是不是有点过渡设计了，而且需要了解很多领域的知识？
我觉得有待商榷：
首先，这是基于前人所研究的基础上，再进一步的加上各自的理解而得出的“宏观概念”；
其次，软件的架构设计与建筑的架构设计有异曲同工之处。但是！软件可以在中途改变或插入许多设计，而建筑不能，建筑一旦建好，你想换个地基是不可能的，所以，建筑的架构设计必须是完完全全、方方面面都需要考虑到的。
最后，框架本身就是一个集大成者，所以了解除前端之外的其它领域，我觉得是必须的。
不然你以为 Angular 这么庞大的一个软件工程是怎么建成的？
也就是说，咱可以先幻想，至于实现，只有实践之后才能考虑具体的细节。

---

想自制一个框架有时候就是心血来潮。

也许本文对你没有参考价值，但这却是代表了我从业到目前为止的最高水平，经历的浓缩。

---

你可以参考市面上流行的框架，完完全全造出一个一模一样的东西。

其次，有想法，特别是经验不足的情况下考虑宏大的设计问题，应该要时刻与他人或外界沟通，闭门造车虽出门合辙，但有时候容易被束缚，沉浸在自己的世界里。

三分钟热度只代表了当前的一个状态，如若三分钟，三天冷静之后，你依然想做这个事，那就说明你值得去做，你应该去做。
